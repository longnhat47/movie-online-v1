{"ast":null,"code":"import axios from 'axios';\nimport env from \"../../env\";\nexport default class Http {\n  constructor(status) {\n    this.handlerEnabled = status && status.handlerEnabled ? status.handlerEnabled : false;\n    this.instance = axios.create({\n      baseURL: env.API_URL\n    });\n    return this.init();\n  }\n  async checkToken(token) {\n    try {\n      var res = await axios.post('http://127.0.0.1:8000/api/token/verify/', {\n        'token': token + '1'\n      });\n    } catch (error) {\n      console.log(error.response.status);\n    }\n    return res;\n  }\n  async requestHandler(request) {\n    const store = require(\"../store\");\n    console.log('store');\n    console.log(store.default.state);\n    const token = localStorage.getItem('token');\n    console.log('before check');\n    console.log(token);\n    console.log(token != null);\n    if (token != null) {\n      var res = await this.checkToken(token);\n      console.log(res.status == 200);\n      if (res.status == 401) {\n        console.log('ok');\n        localStorage.removeItem('token');\n        console.log(localStorage.getItem('token'));\n        store.default.state.user.currentUser = null;\n      }\n      if (res.status == 200) {\n        const authenticated = !request.url.startsWith(\"login\");\n        if (authenticated) {\n          console.log(token);\n          request.headers[\"Authorization\"] = `Bearer ${token}`;\n        }\n      }\n    }\n    console.log('after check');\n    return request;\n  }\n  errorHandler(error) {\n    if (error?.response?.status === 401) {\n      return error.response;\n    }\n    console.log(error);\n    return Promise.reject(error);\n  }\n  successHandler(response) {\n    if (this.handlerEnabled) {\n      return response; // TODO: Handle Success Response if need\n    }\n\n    return response;\n  }\n  init() {\n    this.instance.interceptors.request.use(request => this.requestHandler(request));\n    this.instance.interceptors.response.use(response => this.successHandler(response), error => this.errorHandler(error));\n    return this.instance;\n  }\n}","map":{"version":3,"names":["axios","env","Http","constructor","status","handlerEnabled","instance","create","baseURL","API_URL","init","checkToken","token","res","post","error","console","log","response","requestHandler","request","store","require","default","state","localStorage","getItem","removeItem","user","currentUser","authenticated","url","startsWith","headers","errorHandler","Promise","reject","successHandler","interceptors","use"],"sources":["D:/nhatj/WorkSpace/MovieOnline/movie-web/src/services/http.init.js"],"sourcesContent":["import axios from 'axios'\nimport env from \"../../env\";\n\nexport default class Http {\n\n  constructor(status) {\n    this.handlerEnabled =\n      status && status.handlerEnabled ? status.handlerEnabled : false;\n    this.instance = axios.create({\n      baseURL: env.API_URL,\n    });\n    return this.init();\n  }\n\n  async checkToken(token) {\n    try {\n      var res = await axios.post('http://127.0.0.1:8000/api/token/verify/', { 'token': token+'1' })\n\n    } catch (error) {\n      console.log(error.response.status);\n    }\n    return res\n  }\n\n  async requestHandler(request) {\n    const store = require(\"../store\");\n    console.log('store')\n    console.log(store.default.state)\n    const token = localStorage.getItem('token')\n    console.log('before check')\n    console.log(token)\n    console.log(token != null)\n    if (token != null) {\n      var res = await this.checkToken(token)\n      console.log(res.status == 200)\n      if (res.status == 401) {\n        console.log('ok')\n        localStorage.removeItem('token');\n        console.log(localStorage.getItem('token'))\n        store.default.state.user.currentUser = null\n      }\n      if (res.status == 200) {\n        const authenticated = !request.url.startsWith(\"login\");\n        if (authenticated) {\n          console.log(token)\n          request.headers[\"Authorization\"] = `Bearer ${token}`\n        }\n      }\n    }\n    console.log('after check')\n\n    return request;\n  }\n\n  errorHandler(error) {\n    if (error?.response?.status === 401) {\n      return error.response\n    }\n    console.log(error)\n    return Promise.reject(error);\n  }\n\n  successHandler(response) {\n    if (this.handlerEnabled) {\n      return response; // TODO: Handle Success Response if need\n    }\n    return response;\n  }\n\n  init() {\n    this.instance.interceptors.request.use((request) =>\n      this.requestHandler(request)\n    );\n    this.instance.interceptors.response.use(\n      (response) => this.successHandler(response),\n      (error) => this.errorHandler(error)\n    );\n    return this.instance;\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}