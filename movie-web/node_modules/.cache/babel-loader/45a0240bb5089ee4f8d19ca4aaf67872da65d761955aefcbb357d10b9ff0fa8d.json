{"ast":null,"code":"import axios from 'axios';\nimport env from \"../../env\";\nexport default class Http {\n  constructor(status) {\n    this.handlerEnabled = status && status.handlerEnabled ? status.handlerEnabled : false;\n    this.instance = axios.create({\n      baseURL: env.API_URL\n    });\n    return this.init();\n  }\n  async requestHandler(request) {\n    const store = require(\"../store\");\n    console.log('store');\n    console.log(store.default.state);\n    // console.log(store.default.replaceState)\n    // const token = localStorage.getItem('token')\n    // const token = store ? store.default.state.user.currentUser.token.access : null;\n    const token = 'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNjc5MjQ1MzI4LCJpYXQiOjE2NzkxNTg5MjgsImp0aSI6IjM4ZTU0YjAyZDBiNjRkMDNiNmQzNzE1NGQzZjkxYjhjIiwidXNlcl9pZCI6MX0.PPq-Y2hU5L1qy7tF-0XJw-gjqe3UXwc5D3eG4w7caG0';\n    // if(token){\n    const res = await axios.post('http://127.0.0.1:8000/api/token/verify/', {\n      'token': token\n    });\n    // if(res.status == 200){\n    //   request.headers[\"Authorization\"] = `Bearer ${token}`;\n    // }\n    console.log(res);\n    if (res.status == 401) {\n      console.log('ok');\n      store.default.mutations.commit('LOG_OUT');\n    }\n    // }\n    return request;\n  }\n  errorHandler(error) {\n    if (error?.response?.status === 401) {\n      return error.response;\n    }\n    console.log(error);\n    return Promise.reject(error);\n  }\n  successHandler(response) {\n    if (this.handlerEnabled) {\n      return response; // TODO: Handle Success Response if need\n    }\n\n    return response;\n  }\n  init() {\n    this.instance.interceptors.request.use(request => this.requestHandler(request));\n    this.instance.interceptors.response.use(response => this.successHandler(response), error => this.errorHandler(error));\n    return this.instance;\n  }\n}","map":{"version":3,"names":["axios","env","Http","constructor","status","handlerEnabled","instance","create","baseURL","API_URL","init","requestHandler","request","store","require","console","log","default","state","token","res","post","mutations","commit","errorHandler","error","response","Promise","reject","successHandler","interceptors","use"],"sources":["D:/nhatj/WorkSpace/MovieOnline/movie-web/src/services/http.init.js"],"sourcesContent":["import axios from 'axios'\nimport env from \"../../env\";\n\nexport default class Http {\n\n  constructor(status) {\n    this.handlerEnabled =\n      status && status.handlerEnabled ? status.handlerEnabled : false;\n    this.instance = axios.create({\n      baseURL: env.API_URL,\n    });\n    return this.init();\n  }\n\n  async requestHandler(request) {\n    const store = require(\"../store\");\n    console.log('store')\n    console.log(store.default.state)\n    // console.log(store.default.replaceState)\n    // const token = localStorage.getItem('token')\n    // const token = store ? store.default.state.user.currentUser.token.access : null;\n    const token = 'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNjc5MjQ1MzI4LCJpYXQiOjE2NzkxNTg5MjgsImp0aSI6IjM4ZTU0YjAyZDBiNjRkMDNiNmQzNzE1NGQzZjkxYjhjIiwidXNlcl9pZCI6MX0.PPq-Y2hU5L1qy7tF-0XJw-gjqe3UXwc5D3eG4w7caG0'\n    // if(token){\n      const res = await axios.post('http://127.0.0.1:8000/api/token/verify/', {'token': token})\n      // if(res.status == 200){\n      //   request.headers[\"Authorization\"] = `Bearer ${token}`;\n      // }\n      console.log(res)\n      if(res.status == 401){\n        console.log('ok')\n        store.default.mutations.commit('LOG_OUT')\n      }\n    // }\n    return request;\n  }\n\n  errorHandler(error) {\n    if (error?.response?.status === 401) {\n      return error.response\n    }\n    console.log(error)\n    return Promise.reject(error);\n  }\n\n  successHandler(response) {\n    if (this.handlerEnabled) {\n      return response; // TODO: Handle Success Response if need\n    }\n    return response;\n  }\n\n  init() {\n    this.instance.interceptors.request.use((request) =>\n      this.requestHandler(request)\n    );\n    this.instance.interceptors.response.use(\n      (response) => this.successHandler(response),\n      (error) => this.errorHandler(error)\n    );\n    return this.instance;\n  }\n}\n"],"mappings":"AAAA,OAAOA,KAAK,MAAM,OAAO;AACzB,OAAOC,GAAG,MAAM,WAAW;AAE3B,eAAe,MAAMC,IAAI,CAAC;EAExBC,WAAWA,CAACC,MAAM,EAAE;IAClB,IAAI,CAACC,cAAc,GACjBD,MAAM,IAAIA,MAAM,CAACC,cAAc,GAAGD,MAAM,CAACC,cAAc,GAAG,KAAK;IACjE,IAAI,CAACC,QAAQ,GAAGN,KAAK,CAACO,MAAM,CAAC;MAC3BC,OAAO,EAAEP,GAAG,CAACQ;IACf,CAAC,CAAC;IACF,OAAO,IAAI,CAACC,IAAI,EAAE;EACpB;EAEA,MAAMC,cAAcA,CAACC,OAAO,EAAE;IAC5B,MAAMC,KAAK,GAAGC,OAAO,CAAC,UAAU,CAAC;IACjCC,OAAO,CAACC,GAAG,CAAC,OAAO,CAAC;IACpBD,OAAO,CAACC,GAAG,CAACH,KAAK,CAACI,OAAO,CAACC,KAAK,CAAC;IAChC;IACA;IACA;IACA,MAAMC,KAAK,GAAG,sOAAsO;IACpP;IACE,MAAMC,GAAG,GAAG,MAAMpB,KAAK,CAACqB,IAAI,CAAC,yCAAyC,EAAE;MAAC,OAAO,EAAEF;IAAK,CAAC,CAAC;IACzF;IACA;IACA;IACAJ,OAAO,CAACC,GAAG,CAACI,GAAG,CAAC;IAChB,IAAGA,GAAG,CAAChB,MAAM,IAAI,GAAG,EAAC;MACnBW,OAAO,CAACC,GAAG,CAAC,IAAI,CAAC;MACjBH,KAAK,CAACI,OAAO,CAACK,SAAS,CAACC,MAAM,CAAC,SAAS,CAAC;IAC3C;IACF;IACA,OAAOX,OAAO;EAChB;EAEAY,YAAYA,CAACC,KAAK,EAAE;IAClB,IAAIA,KAAK,EAAEC,QAAQ,EAAEtB,MAAM,KAAK,GAAG,EAAE;MACnC,OAAOqB,KAAK,CAACC,QAAQ;IACvB;IACAX,OAAO,CAACC,GAAG,CAACS,KAAK,CAAC;IAClB,OAAOE,OAAO,CAACC,MAAM,CAACH,KAAK,CAAC;EAC9B;EAEAI,cAAcA,CAACH,QAAQ,EAAE;IACvB,IAAI,IAAI,CAACrB,cAAc,EAAE;MACvB,OAAOqB,QAAQ,CAAC,CAAC;IACnB;;IACA,OAAOA,QAAQ;EACjB;EAEAhB,IAAIA,CAAA,EAAG;IACL,IAAI,CAACJ,QAAQ,CAACwB,YAAY,CAAClB,OAAO,CAACmB,GAAG,CAAEnB,OAAO,IAC7C,IAAI,CAACD,cAAc,CAACC,OAAO,CAAC,CAC7B;IACD,IAAI,CAACN,QAAQ,CAACwB,YAAY,CAACJ,QAAQ,CAACK,GAAG,CACpCL,QAAQ,IAAK,IAAI,CAACG,cAAc,CAACH,QAAQ,CAAC,EAC1CD,KAAK,IAAK,IAAI,CAACD,YAAY,CAACC,KAAK,CAAC,CACpC;IACD,OAAO,IAAI,CAACnB,QAAQ;EACtB;AACF"},"metadata":{},"sourceType":"module","externalDependencies":[]}